<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</title>
    <style>
        body { font-family: 'Times New Roman'; background-color: white; }
        .user-info { float: right; margin: 10px; }
        .filters { margin: 20px 0; padding: 10px; background-color: #f0f0f0; }
        .filters form { display: inline-block; margin-right: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #7FFF00; cursor: pointer; }
        tr.out-of-stock { background-color: lightblue; }
        tr.sale { background-color: #2E8B57; color: white; }
        .old-price { text-decoration: line-through; color: red; }
        .new-price { color: black; font-weight: bold; }
    </style>
</head>
<body>
    <div class="user-info">
        {% if request.user.is_authenticated %}
            {{ request.user.full_name }} ({{ request.user.role }})
            <a href="{% url 'logout' %}">–í—ã–π—Ç–∏</a>
        {% else %}
            –ì–æ—Å—Ç—å
        {% endif %}
    </div>

    <h1>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h1>

    <!-- –ë–ª–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–¥–æ—Å—Ç—É–ø–µ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä—É –∏ –∞–¥–º–∏–Ω—É) -->
    {% if request.user.is_authenticated %}
        {% if request.user.role == '–ú–µ–Ω–µ–¥–∂–µ—Ä' or request.user.role == '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' %}
        <div class="filters">
            <form method="get">
                <label>–ü–æ–∏—Å–∫:</label>
                <input type="text" name="search" value="{{ search_query }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ...">

                <label>–ü–æ—Å—Ç–∞–≤—â–∏–∫:</label>
                <select name="supplier">
                    <option value="">–í—Å–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏</option>
                    {% for supplier in all_suppliers %}
                        <option value="{{ supplier }}" {% if supplier_filter == supplier %}selected{% endif %}>{{ supplier }}</option>
                    {% endfor %}
                </select>

                <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É:</label>
                <select name="sort">
                    <option value="">---</option>
                    <option value="quantity_asc" {% if sort_by == 'quantity_asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                    <option value="quantity_desc" {% if sort_by == 'quantity_desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                </select>

                <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </form>
        </div>
        {% endif %}
    {% endif %}

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
    {% if request.user.is_authenticated and request.user.role == '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' %}
        <a href="{% url 'product_add' %}" style="margin-bottom: 10px; display: inline-block;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
    {% endif %}

    <table>
        <thead>
            <tr>
                <th>–§–æ—Ç–æ</th>
                <th>–ê—Ä—Ç–∏–∫—É–ª</th>
                <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
                <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                <th>–¶–µ–Ω–∞</th>
                <th>–ï–¥. –∏–∑–º.</th>
                <th>–ö–æ–ª-–≤–æ</th>
                <th>–°–∫–∏–¥–∫–∞ %</th>
                {% if request.user.is_authenticated and request.user.role == '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' %}
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr class="{% if product.quantity == 0 %}out-of-stock{% elif product.discount > 15 %}sale{% endif %}">
                <td>
                    {% if product.image %}
                        <img src="{{ MEDIA_URL }}{{ product.image }}" width="50">
                    {% else %}
                        <img src="https://via.placeholder.com/50" alt="–Ω–µ—Ç —Ñ–æ—Ç–æ">
                    {% endif %}
                </td>
                <td>{{ product.article }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.category }}</td>
                <td>{{ product.description|truncatechars:50 }}</td>
                <td>{{ product.brand }}</td>
                <td>{{ product.supplier }}</td>
                <td>
                    {% if product.discount %}
                        <span class="old-price">{{ product.price }}</span>
                        <span class="new-price">{{ product.discounted_price }}</span>
                    {% else %}
                        {{ product.price }}
                    {% endif %}
                </td>
                <td>{{ product.unit }}</td>
                <td>{{ product.quantity }}</td>
                <td>{{ product.discount }}</td>
                {% if request.user.is_authenticated and request.user.role == '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' %}
                <td>
                    <a href="{% url 'product_edit' product.id %}">‚úèÔ∏è</a>
                    <a href="{% url 'product_delete' product.id %}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')">üóëÔ∏è</a>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>